#!/usr/bin/env bash

set -euo pipefail

select_project_repo() {
  local repo; repo="$(
    find -H "$HOME/projects" -maxdepth 2 -type d -or -type l \
      | fzf \
        --border                        \
        --header 'Project Repositories' \
        --height '25%'                  \
        --prompt 'cd '                  \
        --reverse                       \
        --exit-0
  )"; readonly repo

  if [ "$repo" != '' ]; then
    cd "$repo"
    echo -ne "â†’ "; pwd; echo '---'
    exa -l 2>/dev/null || ls -l
  fi
}

select_branch() {
  local branch; branch="$(
    git branch -a \
      | sed -E 's/remotes\/[^\/]*\///g; /(\*|HEAD).*$/d' \
      | sort -u \
      | awk '{$1=$1};1' \
      | fzf \
        --border \
        --header 'Branches' \
        --height 25% \
        --prompt 'git checkout ' \
        --reverse \
        --exit-0
  )"; readonly branch

  [ "$branch" != '' ] && git checkout "$branch"
}

"$@"
